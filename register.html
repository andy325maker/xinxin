<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>注册页面</title>
  <style>
    /* 全局样式重置 */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background-color: #f8f9fa;
      font-family: "微软雅黑", sans-serif;
    }

    .register-container {
      background-color: #fff;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      text-align: center;
      width: 90%;
      max-width: 400px;
    }

    .register-container h1 {
      margin-bottom: 20px;
      font-size: 24px;
      color: #333;
    }

    .register-container input {
      display: block;
      width: 100%;
      height: 45px;
      margin: 10px 0;
      padding: 0 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 16px;
    }

    .register-container button {
      width: 100%;
      height: 45px;
      background-color: #009688;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 10px;
      transition: background-color 0.3s;
    }

    .register-container button:hover {
      background-color: #00796b;
    }

    .error-message {
      color: #ff4d4f; /* 错误提示红色 */
      font-size: 14px;
      margin: 5px 0;
      height: 20px; /* 避免提示出现时页面抖动 */
      text-align: left;
    }

    .login-link {
      margin-top: 20px;
      font-size: 14px;
      color: #666;
    }

    .login-link a {
      text-decoration: none;
      color: #009688;
    }

    .login-link a:hover {
      text-decoration: underline;
    }

    /* 加载状态样式 */
    .loading {
      opacity: 0.7;
      cursor: not-allowed;
    }
  </style>
</head>

<body>
  <div class="register-container">
    <h1>欢迎注册账号</h1>
    <!-- 错误提示区域 -->
    <div class="error-message" id="errorMsg"></div>
    <!-- 输入框添加id，方便JS获取 -->
    <input type="text" id="username" placeholder="请输入账号（手机号）">
    <input type="password" id="password" placeholder="设置密码（不少于6位）">
    <button onclick="register()" id="registerBtn">立即注册</button>
    
    <div class="login-link">
      已有账号？<a href="login.html">立即登录</a>
    </div>
  </div>

  <script>
    function register() {
      // 获取按钮元素，用于添加加载状态
      const registerBtn = document.getElementById('registerBtn');
      // 1. 获取输入框的值
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();
      const errorMsg = document.getElementById('errorMsg');

      // 2. 输入验证
      if (!username) {
        errorMsg.textContent = '请输入账号';
        return;
      }
      
      // 验证手机号格式
      if (!/^1[3-9]\d{9}$/.test(username)) {
        errorMsg.textContent = '请输入正确的手机号作为账号';
        return;
      }
      
      if (!password) {
        errorMsg.textContent = '请设置密码';
        return;
      }
      
      if (password.length < 6) {
        errorMsg.textContent = '密码长度不能少于6位';
        return;
      }

      // 3. 检查是否已注册
      const storedUsers = localStorage.getItem('registeredUsers') || '[]';
      const users = JSON.parse(storedUsers);
      
      // 检查用户名是否已存在
      if (users.some(user => user.username === username)) {
        errorMsg.textContent = '该账号已被注册，请更换账号';
        return;
      }

      // 4. 验证通过，保存数据
      errorMsg.textContent = '';
      
      // 添加加载状态，防止重复点击
      registerBtn.disabled = true;
      registerBtn.classList.add('loading');
      registerBtn.textContent = '注册中...';
      
      try {
        // 创建用户数据对象
        const newUser = {
          username: username,
          password: password,
          registerTime: new Date().toLocaleString()
        };
        
        // 添加新用户到数组
        users.push(newUser);
        
        // 保存到localStorage
        localStorage.setItem('registeredUsers', JSON.stringify(users));
        
        // 显示成功消息并延迟跳转，确保用户看到提示
        alert('注册成功！即将跳转到登录页面');
        
        // 使用setTimeout确保alert关闭后再跳转
        setTimeout(() => {
          // 确保登录页面路径正确
          const loginPageUrl = 'login.html';
          
          // 尝试跳转
          window.location.href = loginPageUrl;
          
          // 安全检查：如果跳转失败，提供备用方案
          setTimeout(() => {
            if (window.location.href.indexOf(loginPageUrl) === -1) {
              alert('跳转失败，请点击下方"立即登录"链接');
              // 恢复按钮状态
              registerBtn.disabled = false;
              registerBtn.classList.remove('loading');
              registerBtn.textContent = '立即注册';
            }
          }, 1000);
        }, 100);
        
      } catch (error) {
        // 处理可能的错误
        errorMsg.textContent = '注册过程出错，请重试';
        console.error('注册错误:', error);
        
        // 恢复按钮状态
        registerBtn.disabled = false;
        registerBtn.classList.remove('loading');
        registerBtn.textContent = '立即注册';
      }
    }

    // 支持按回车键注册
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Enter') {
        // 检查按钮是否可用，防止重复提交
        if (!document.getElementById('registerBtn').disabled) {
          register();
        }
      }
    });
  </script>
</body>
</html>
    